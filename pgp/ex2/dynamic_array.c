#include "../../jvm/include/interpretedjvm.h"
#include "../../jvm/include/interpreter/instructionhelper.h"
#include <stdio.h>
#include <stdlib.h>

// @formatter:off
/*
package pgp.ex2.task6;

import pgp.utils.EntryPoint;

public class DynamicArray {

	private static class DynamicArrayInstance {

		public byte[] array;
		public int numElements;
		public int maxElements;

		public void append(byte element) {
			if (numElements >= maxElements) {
				expand(maxElements * 2);
			}
			array[numElements] = element;
			numElements++;
		}

		private void expand(int newSize) {
			byte[] newArray = new byte[newSize];
			System.arraycopy(array, 0, newArray, 0, array.length);
			array = newArray;
			maxElements = newSize;
		}

	}

	@EntryPoint
	public static DynamicArrayInstance initArray(int desSize) {
		DynamicArrayInstance result = new DynamicArrayInstance();
		result.array = new byte[desSize];
		result.numElements = 0;
		result.maxElements = desSize;
		return result;
	}

	@EntryPoint
	public static void insert(DynamicArrayInstance dynArray, byte element) {
		dynArray.append(element);
	}

	@EntryPoint
	public static void destroyArray(DynamicArrayInstance dynArray) {
		dynArray.array = null;
		dynArray.numElements = 0;
		dynArray.maxElements = 0;
	}
}
 */
// pgp/ex2/task6/DynamicArray
const char* file1[] = {"000004f8","cafebabe0000003200370a000900260700270a000200280900020029090002002a090002002b0a0002002c07002d07002e07002f01000001000c496e6e657243","6c617373657301001444796e616d69634172726179496e7374616e63650100063c696e69743e010003282956010004436f646501000f4c696e654e756d626572","5461626c650100124c6f63616c5661726961626c655461626c650100047468697301001c4c7067702f6578322f7461736b362f44796e616d696341727261793b","010009696e697441727261790100342849294c7067702f6578322f7461736b362f44796e616d696341727261792444796e616d69634172726179496e7374616e","63653b01000764657353697a6501000149010006726573756c740100314c7067702f6578322f7461736b362f44796e616d696341727261792444796e616d6963","4172726179496e7374616e63653b01001b52756e74696d65496e76697369626c65416e6e6f746174696f6e730100164c7067702f7574696c732f456e74727950","6f696e743b010006696e73657274010035284c7067702f6578322f7461736b362f44796e616d696341727261792444796e616d69634172726179496e7374616e","63653b42295601000864796e4172726179010007656c656d656e740100014201000c64657374726f794172726179010034284c7067702f6578322f7461736b36","2f44796e616d696341727261792444796e616d69634172726179496e7374616e63653b295601000a536f7572636546696c6501002644796e616d696341727261","792e6a6176612066726f6d20496e70757446696c654f626a6563740c000e000f01002f7067702f6578322f7461736b362f44796e616d69634172726179244479","6e616d69634172726179496e7374616e63650c000e00300c003100320c003300180c003400180c0035003601001a7067702f6578322f7461736b362f44796e61","6d696341727261790100106a6176612f6c616e672f4f626a65637401001c7067702f6578322f7461736b362f44796e616d696341727261792431010021284c70","67702f6578322f7461736b362f44796e616d6963417272617924313b295601000561727261790100025b4201000b6e756d456c656d656e747301000b6d617845","6c656d656e7473010006617070656e64010004284229560021000800090000000000040001000e000f000100100000003300010001000000052ab70001b10000","000200110000000a0002000000050004000700120000000c0001000000050013001400000009001500160002001000000060000300020000001cbb00025901b7","00034c2b1abc08b500042b03b500052b1ab500062bb000000002001100000016000500000020000900210010002200150023001a002400120000001600020000","001c001700180000000900130019001a0001001b000000060001001c00000009001d001e000200100000003e00020002000000062a1bb60007b1000000020011","0000000a0002000000290005002a001200000016000200000006001f001a000000000006002000210001001b000000060001001c000000090022002300020010","0000004600020001000000102a01b500042a03b500052a03b50006b10000000200110000001200040000002e0005002f000a0030000f003100120000000c0001","00000010001f001a0000001b000000060001001c000000020024000000020025000c000000120002000a00080000100800020008000d000a"};
// pgp/ex2/task6/DynamicArray$DynamicArrayInstance
const char* file2[] = {"00000491","cafebabe0000003200370a000800280a000900280900080029090008002a0a0008002b090008002c0a002d002e07003007003101000561727261790100025b42","01000b6e756d456c656d656e74730100014901000b6d6178456c656d656e74730100063c696e69743e010003282956010004436f646501000f4c696e654e756d","6265725461626c650100124c6f63616c5661726961626c655461626c650100047468697301001444796e616d69634172726179496e7374616e636501000c496e","6e6572436c61737365730100314c7067702f6578322f7461736b362f44796e616d696341727261792444796e616d69634172726179496e7374616e63653b0100","06617070656e6401000428422956010007656c656d656e740100014201000d537461636b4d61705461626c65010006657870616e64010004284929560100076e","657753697a650100086e65774172726179070032010000010021284c7067702f6578322f7461736b362f44796e616d6963417272617924313b29560100027830","01001e4c7067702f6578322f7461736b362f44796e616d6963417272617924313b01000a536f7572636546696c6501002644796e616d696341727261792e6a61","76612066726f6d20496e70757446696c654f626a6563740c000f00100c000c000d0c000e000d0c001d001e0c000a000b0700330c0034003507003601002f7067","702f6578322f7461736b362f44796e616d696341727261792444796e616d69634172726179496e7374616e63650100106a6176612f6c616e672f4f626a656374","01001c7067702f6578322f7461736b362f44796e616d6963417272617924310100106a6176612f6c616e672f53797374656d0100096172726179636f70790100","2a284c6a6176612f6c616e672f4f626a6563743b494c6a6176612f6c616e672f4f626a6563743b4949295601001a7067702f6578322f7461736b362f44796e61","6d69634172726179002000080009000000030001000a000b00000001000c000d00000001000e000d000000040002000f0010000100110000002f000100010000","00052ab70002b10000000200120000000600010000000700130000000c0001000000050014001700000001001800190001001100000077000300020000002a2a","b400032ab40004a1000d2a2ab400040568b700052ab400062ab400031b542a59b400030460b50003b10000000300120000001600050000000e000b000f001500","11001f00120029001300130000001600020000002a0014001700000000002a001a001b0001001c000000030001150002001d001e000100110000006c00050003","0000001e1bbc084d2ab40006032c032ab40006beb800072a2cb500062a1bb50004b100000002001200000016000500000016000400170013001800180019001d","001a00130000002000030000001e0014001700000000001e001f000d00010004001a0020000b00021000000f0023000100110000003900010002000000052ab7","0001b100000002001200000006000100000007001300000016000200000005001400170000000000050024002500010002002600000002002700160000001200","020008002f0015000a0021002f00001008"};

// java/lang/Object
const char* file3[] = {"000005c3","cafebabe00000031004e0700310a000100320a001200330a003400350a000100360800370a001200380a0039003a0a0001003b07003c08003d0a000a003e0300","0f423f08003f030007a1200a001200400a001200410700420100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c65","01000f72656769737465724e617469766573010008676574436c61737301001328294c6a6176612f6c616e672f436c6173733b0100095369676e617475726501","001628294c6a6176612f6c616e672f436c6173733c2a3e3b01000868617368436f6465010003282949010006657175616c73010015284c6a6176612f6c616e67","2f4f626a6563743b295a010005636c6f6e6501001428294c6a6176612f6c616e672f4f626a6563743b01000a457863657074696f6e73070043010008746f5374","72696e6701001428294c6a6176612f6c616e672f537472696e673b0100066e6f746966790100096e6f74696679416c6c01000477616974010004284a29560700","44010005284a49295601000866696e616c697a650700450100083c636c696e69743e01000a536f7572636546696c6501000b4f626a6563742e6a617661010017","6a6176612f6c616e672f537472696e674275696c6465720c001300140c001800190700460c004700250c00480049010001400c001c001d07004a0c004b004c0c","002400250100226a6176612f6c616e672f496c6c6567616c417267756d656e74457863657074696f6e01001974696d656f75742076616c7565206973206e6567","61746976650c0013004d0100256e616e6f7365636f6e642074696d656f75742076616c7565206f7574206f662072616e67650c002800290c001700140100106a","6176612f6c616e672f4f626a6563740100246a6176612f6c616e672f436c6f6e654e6f74537570706f72746564457863657074696f6e01001e6a6176612f6c61","6e672f496e746572727570746564457863657074696f6e0100136a6176612f6c616e672f5468726f7761626c6501000f6a6176612f6c616e672f436c61737301","00076765744e616d65010006617070656e6401002d284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e674275696c6465","723b0100116a6176612f6c616e672f496e746567657201000b746f486578537472696e670100152849294c6a6176612f6c616e672f537472696e673b01001528","4c6a6176612f6c616e672f537472696e673b295600210012000000000000000e00010013001400010015000000190000000100000001b1000000010016000000","06000100000014010a0017001400000111001800190001001a00000002001b0101001c001d00000001001e001f0001001500000023000200020000000b2a2ba6","000704a7000403ac00000001001600000006000100000086010400200021000100220000000400010023000100240025000100150000003c0002000100000024","bb000159b700022ab60003b60004b600051206b600052ab60007b80008b60005b60009b0000000010016000000060001000000db011100260014000001110027","0014000001110028002900010022000000040001002a00110028002b0002001500000072000400040000003e1f09949c000dbb000a59120bb7000cbf1d9b0009","1d120da4000dbb000a59120eb7000cbf1d120fa2000d1d99000d1f09949a00071f0a61402a1fb60010b1000000010016000000220008000001ae000601af0010","01b2001a01b3002401b7003401b8003801bb003d01bc0022000000040001002a001100280014000200150000002200030001000000062a09b60010b100000001","00160000000a0002000001e5000501e60022000000040001002a0004002c001400020015000000190000000100000001b1000000010016000000060001000002","170022000000040001002d0008002e001400010015000000200000000000000004b80011b10000000100160000000a000200000018000300190001002f000000","020030"};
// java/lang/System
const char* file4[] = {"00001852","cafebabe00000031016e08000b08003f08004008004808006608006708007b08008308008c08008d01000001000328294a01001428294c6a6176612f6c616e67","2f537472696e673b01000328295601000328295a01000428492956010015284c6a6176612f6c616e672f4f626a6563743b295a010026284c6a6176612f6c616e","672f537472696e673b294c6a6176612f6c616e672f537472696e673b010015284c6a6176612f6c616e672f537472696e673b2956010027284c6a6176612f6c61","6e672f537472696e673b4c6a6176612f6c616e672f537472696e673b2956010004285a29560100083c636c696e69743e0100063c696e69743e010004436f6465","01000a4465707265636174656401000a457863657074696f6e7301000c496e6e6572436c61737365730100154c6a6176612f696f2f5072696e7453747265616d","3b01001952756e74696d6556697369626c65416e6e6f746174696f6e730100095369676e6174757265010003616464010010616c6c6f77417272617953796e74","6178010006617070656e640100096172726179636f7079010006626f6f746564010007636865636b494f010008636865636b4b6579010012636865636b506163","6b61676541636365737301000f636865636b5065726d697373696f6e010015636865636b50726f70657274696573416363657373010013636865636b50726f70","6572747941636365737301000d636c65617250726f7065727479010004636f6e73010007636f6e736f6c6501000d63757272656e745468726561640100116375","7272656e7454696d654d696c6c697301000c646f50726976696c65676564010006657175616c7301000365727201000465786974010002676301001b67657441","6e6452656d6f7665436163686550726f7065727469657301000e67657443616c6c6572436c617373010008676574436c61737301000e676574436c6173734c6f","6164657201000f6765744a617661494f41636365737301000d67657450726f7065727469657301000b67657450726f706572747901000a67657452756e74696d","6501001267657453656375726974794d616e6167657201000e67657454687265616447726f7570010006676574656e76010007676574656e762e010008676574","656e762e2a0100106964656e7469747948617368436f6465010002696e010010696e686572697465644368616e6e656c010004696e697401000e696e69745072","6f70657274696573010017696e697469616c697a654f53456e7669726f6e6d656e74010015696e697469616c697a6553797374656d436c6173730100096a6176","612e6c616e6701001b6a6176612f696f2f4275666665726564496e70757453747265616d01001c6a6176612f696f2f42756666657265644f7574707574537472","65616d0100166a6176612f696f2f46696c6544657363726970746f720100176a6176612f696f2f46696c65496e70757453747265616d0100186a6176612f696f","2f46696c654f757470757453747265616d0100136a6176612f696f2f494f457863657074696f6e0100136a6176612f696f2f5072696e7453747265616d01000f","6a6176612f6c616e672f436c6173730100136a6176612f6c616e672f457863657074696f6e0100226a6176612f6c616e672f496c6c6567616c417267756d656e","74457863657074696f6e0100116a6176612f6c616e672f496e746567657201001e6a6176612f6c616e672f4e756c6c506f696e746572457863657074696f6e01","00106a6176612f6c616e672f4f626a65637401001c6a6176612f6c616e672f50726f63657373456e7669726f6e6d656e740100116a6176612f6c616e672f5275","6e74696d6501001b6a6176612f6c616e672f52756e74696d655065726d697373696f6e0100196a6176612f6c616e672f53656375726974794d616e6167657201","00106a6176612f6c616e672f537472696e670100176a6176612f6c616e672f537472696e674275696c6465720100106a6176612f6c616e672f53797374656d01","00126a6176612f6c616e672f53797374656d24310100126a6176612f6c616e672f53797374656d24320100146a6176612f6c616e672f5465726d696e61746f72","0100106a6176612f6c616e672f5468726561640100156a6176612f6c616e672f54687265616447726f75700100266a6176612f6e696f2f6368616e6e656c732f","7370692f53656c6563746f7250726f766964657201001e6a6176612f73656375726974792f416363657373436f6e74726f6c6c65720100146a6176612f757469","6c2f50726f7065727469657301001c6a6176612f7574696c2f50726f70657274795065726d697373696f6e0100126b65792063616e277420626520656d707479","0100116b65792063616e2774206265206e756c6c0100046c6f61640100056c6f61643001000b6c6f61644c69627261727901000c6c6f61644c69627261727930","01000e6d61704c6962726172794e616d6501000f6d61784469726563744d656d6f72790100086e616e6f54696d6501000f6e756c6c496e70757453747265616d","01000f6e756c6c5072696e7453747265616d0100036f757401000570726f707301000870726f766964657201000f72656769737465724e617469766573010006","72656d6f766501000f72756e46696e616c697a6174696f6e01001372756e46696e616c697a6572734f6e45786974010008736563757269747901000673657445","727201000773657445727230010005736574494f010005736574496e010006736574496e300100117365744a6176614c616e674163636573730100067365744f","75740100077365744f75743001000d73657450726f7065727469657301000b73657450726f706572747901001273657453656375726974794d616e6167657201","001373657453656375726974794d616e6167657230010005736574757001001573756e2f6d6973632f4a617661494f41636365737301001673756e2f6d697363","2f5368617265645365637265747301000b73756e2f6d6973632f564d01001073756e2f6d6973632f56657273696f6e01001673756e2f7265666c6563742f5265","666c656374696f6e010008746f537472696e6701000577726974650100037a697007004907004a07004b07004c07004d07004e07004f07005007005107005207","005307005407005507005607005707005807005907005a07005b07005c07005d07005e07005f0700600700610700620700630700640700650700860700870700","8807008907008a0100114c6a6176612f696f2f436f6e736f6c653b0100184c6a6176612f696f2f46696c6544657363726970746f723b0100154c6a6176612f69","6f2f496e70757453747265616d3b0100164c6a6176612f6c616e672f446570726563617465643b01001b4c6a6176612f6c616e672f53656375726974794d616e","616765723b0100164c6a6176612f7574696c2f50726f706572746965733b01001328294c6a6176612f696f2f436f6e736f6c653b01001b284c6a6176612f696f","2f46696c6544657363726970746f723b295601001728294c6a6176612f696f2f496e70757453747265616d3b010018284c6a6176612f696f2f496e7075745374","7265616d3b295601001a284c6a6176612f696f2f4f757470757453747265616d3b49295601001a284c6a6176612f696f2f4f757470757453747265616d3b5a29","5601001728294c6a6176612f696f2f5072696e7453747265616d3b010018284c6a6176612f696f2f5072696e7453747265616d3b295601001328294c6a617661","2f6c616e672f436c6173733b0100142849294c6a6176612f6c616e672f436c6173733b01001928294c6a6176612f6c616e672f436c6173734c6f616465723b01","0015284c6a6176612f6c616e672f4f626a6563743b294901001528294c6a6176612f6c616e672f52756e74696d653b01001d28294c6a6176612f6c616e672f53","656375726974794d616e616765723b01001e284c6a6176612f6c616e672f53656375726974794d616e616765723b295601001428294c6a6176612f6c616e672f","5468726561643b010015284c6a6176612f6c616e672f5468726561643b295601001928294c6a6176612f6c616e672f54687265616447726f75703b01001d2829","4c6a6176612f6e696f2f6368616e6e656c732f4368616e6e656c3b01002a28294c6a6176612f6e696f2f6368616e6e656c732f7370692f53656c6563746f7250","726f76696465723b01001d284c6a6176612f73656375726974792f5065726d697373696f6e3b295601001128294c6a6176612f7574696c2f4d61703b01001828","294c6a6176612f7574696c2f50726f706572746965733b010019284c6a6176612f7574696c2f50726f706572746965733b295601001928294c73756e2f6d6973","632f4a617661494f4163636573733b01001c284c73756e2f6d6973632f4a6176614c616e674163636573733b2956010026284c6a6176612f6c616e672f4f626a","6563743b294c6a6176612f6c616e672f4f626a6563743b01002a284c6a6176612f6c616e672f4f626a6563743b494c6a6176612f6c616e672f4f626a6563743b","49492956010034284c6a6176612f73656375726974792f50726976696c65676564416374696f6e3b294c6a6176612f6c616e672f4f626a6563743b010026284c","6a6176612f6c616e672f436c6173733b4c6a6176612f6c616e672f537472696e673b295601002d284c6a6176612f6c616e672f537472696e673b294c6a617661","2f6c616e672f537472696e674275696c6465723b01002e284c6a6176612f7574696c2f50726f706572746965733b294c6a6176612f7574696c2f50726f706572","746965733b010038284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f4f626a6563743b","010038284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b0100372829","4c6a6176612f7574696c2f4d61703c4c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b3e3b0c002b00b00c003100b10c","004200b10c007100b10c004200b20c0031001c0c0071001c0c007800b40c007200b50c002e000c0c006d000c0c0017000e0c0023000e0c0024000e0c0028000e","0c0033000e0c0034000e0c0044000e0c0046000e0c0074000e0c0076000e0c007e000e0c0085000e0c0020000f0c003200100c007700150c002c00b60c001700","b70c006f00b80c001700b90c007d00b90c001700ba0c001700bb0c007000bc0c007a00bd0c008000bd0c003500be0c003600be0c003500bf0c003700c00c0030","00110c003b00c20c003c00c30c001700c40c008400c40c008b000d0c001700130c002500130c002600130c002900130c006a00130c002d00c50c001f00c60c00","3d00c70c004300c80c007300c90c002700ca0c003e00cb0c003800ce0c007e00cf0c007500d00c002f00d20c006900d30c006b00d30c003a00120c003e00120c","001700140c002100d40c004500d50c008200d60c003a00d709009000da09009000db09009000dc0900a100d90900a100dd0900a100de0900a100df0900a100e0","0900a100e10a008e00f60a008f00f80a009100f40a009200f40a009400f90a009501000a009701070a009800e90a009900e40a009901070a009a00e40a009a00","fe0a009b01120a009b011a0a009c00e80a009c00ed0a009c00f10a009c00f20a009c01020a009c01170a009c01180a009d01070a009e00e70a009e01090a009e","010a0a009e01110a009f01010a00a000e40a00a001060a00a0011c0a00a100e20a00a100e60a00a100ec0a00a100ee0a00a100f50a00a100f70a00a100fa0a00","a100fb0a00a100fc0a00a100fd0a00a101030a00a101050a00a101080a00a1010b0a00a1011d0a00a201040a00a300e40a00a400ef0a00a5010c0a00a5010e0a","00a6010d0a00a7010f0a00a701100a00a801160a00a900e40a00a901150a00a901190a00a9011e0a00a9011f0a00aa011b0a00ac01130a00ac01140a00ad00e3","0a00ad00e50a00ad00eb0a00ad00f00a00ae00ea0a00af00ff0b00ab00f3003100a1009a000000060019004200b2000000190071001c000000190031001c0000","004a007800b40000004a002b00b00000000a007200b500000029010a0074000e000000020017000e000100180000001100010001000000052ab70133b1000000","000009007c00b900010018000000140001000100000008b801482ab8014cb1000000000009007f00bd00010018000000140001000100000008b801482ab8014f","b1000000000009007900bd00010018000000140001000100000008b801482ab8014eb1000000000009002c00b600010018000000410002000200000025b20123","c7001e1300a1594bc2b80165b9016d0100b301232ac3a700084c2ac32bbfb20123b00002000c0019001c0000001c001f001c000000000009004300c800020018","000000130001000000000007b8015db6015cb000000000001a0000000400010093000a0024000e00010018000000220004000100000016b801514b2ac600102a","bb009d591207b7013eb60142b100000000010a007d00b90000010a008000bd0000010a007a00bd00000009008300c40001001800000023000200020000000f2a","1204b60140a700044c2ab80152b1000100000006000900960000002a008400c400010018000000400004000200000034b801514c2bc600102bbb009d591208b7","013eb601422ac600192ab60134b6012ec6000fbb00a2592ab70156b8015e572ab30127b1000000000009003c00c300010018000000100001000000000004b201","27b0000000000109002e000c00000109006e000c00000109002200d100000109004100c10000010a004500d500000009003900cc000100180000001c00010001","00000010b801514b2ac600072ab6013fb20128b0000000000009008100cd000100180000002e0002000200000022b801514c2bc600072bb6013f2ac70010bb00","a959b7015f4b2ab80155572ab30128b1000000000009003a0012000100180000002500020002000000192ab80153b801514c2bc600082b2ab60141b201282ab6","0161b0000000000009003a00d70001001800000026000300030000001a2ab80153b801514d2cc600082c2ab60141b201282a2bb60163b0000000000009008200","d7000100180000003200050003000000262ab80153b801514d2cc600112cbb00aa592a1209b70164b60142b201282a2bb60162c0009fb0000000000009002a00","12000100180000003100050002000000252ab80153b801514c2bc600112bbb00aa592a1209b70164b60142b201282ab60160c0009fb000000000000a00250013","000100180000002e00030001000000222ac7000dbb0099591206b70132bf2a1201b6014399000dbb0097591205b7012fbfb1000000000009003e001200010018","00000037000500020000002bb801514c2bc600212bbb009d59bb00a059b701441202b601462ab60146b60145b7013eb601422ab80136b0000000000009003e00","cb00020018000000250004000100000019b801514b2ac600102abb009d591203b7013eb60142b80135b000000000001e0000000200d800090032001000010018","000000140002000100000008b8013b1ab60139b10000000000090033000e00010018000000130001000000000007b8013bb60137b10000000000090076000e00","010018000000130001000000000007b8013bb60138b10000000000090077001500030018000000150001000100000009b8013b571ab8013ab100000000001900","000000001d00000006000100b300000009006800130001001800000017000300010000000bb8013bb801502ab6013cb1000000000009006a0013000100180000","0017000300010000000bb8013bb801502ab6013db1000000000109006c00120000000a006f00b8000200180000001e0004000000000012b8014709949e000501","b0bb009959b70131bf00000000001a0000000400010099000a007000bc000200180000001e0004000000000012b8014709949e000501b0bb009959b70131bf00","000000001a0000000400010099000a0047000e00010018000000a10006000400000095bb00a959b7015fb30128b20128b8015557b8016bb8014ab80130120ab8","0154bb009159b20121b7012b4bbb009259b20122b7012c4cbb009259b20120b7012c4dbb008e592ab70129b8014cbb009459bb008f592b110080b7012a04b701","2db8014fbb009459bb008f592c110080b7012a04b7012db8014eb80158b80169b8016758b8016a57b80168b801594e2db6015a2db6015bb100000000000a007e","000e0001001800000017000200000000000bbb00a359b70157b80166b1000000000008003500be0001001800000011000100000000000506b8016cb000000000","00080016000e000100180000002a000100000000001eb80149b8014bb30124b8014db30126b8014db3012501b3012701b30123b1000000000001001b00000012","000200a200000000000800a3000000000008"};

// @formatter:on

const char **files[] = {file1, file2, file3, file4};
int numFiles = sizeof(files) / sizeof(files[0]);
InterpretedJVM jvm;

HeapPointer initArray(I4 desSize) {
    if (desSize < 0) {
        printf("cannot create array with size < 0!");
        exit(-1);
    }

    push_U4(&jvm, desSize);
    push_Method(&jvm,
                "pgp/ex2/task6/DynamicArray",
                "initArray",
                "(I)Lpgp/ex2/task6/DynamicArray$DynamicArrayInstance;"
    );
    HeapPointer returnValue = executeAllMethods_SingleReturn(&jvm);
    assertObjectType(OBJ_ObjectRef, returnValue);
    return returnValue;
}

void destroyArray(HeapPointer array) {
    push_Object(&jvm, array);
    push_Method(&jvm,
                "pgp/ex2/task6/DynamicArray",
                "destroyArray",
                "(Lpgp/ex2/task6/DynamicArray$DynamicArrayInstance;)V"
    );
    executeAllMethods_NoReturn(&jvm);
}

void insert(HeapPointer array, char elem) {
    push_Object(&jvm, array);
    incrementReferenceCount(array); // object wird beibehalten.

    push_U4(&jvm, elem);
    push_Method(&jvm,
                "pgp/ex2/task6/DynamicArray",
                "insert",
                "(Lpgp/ex2/task6/DynamicArray$DynamicArrayInstance;B)V"
    );
    executeAllMethods_NoReturn(&jvm);
}

void printDynamicArray(HeapPointer array) {
    const ClassFile *dynArrayInstanceClass = getClassFile_byName(
            jvm.classLoader,
            "pgp/ex2/task6/DynamicArray$DynamicArrayInstance"
    );
    const int fieldIndex_array = findFieldIndexInClass(dynArrayInstanceClass, "array");
    const int fieldIndex_numElements = findFieldIndexInClass(dynArrayInstanceClass, "numElements");
    const int fieldIndex_maxElements = findFieldIndexInClass(dynArrayInstanceClass, "maxElements");

    U4 numElements = primitiveInt_getValue(objectRef_getFieldValue(array, fieldIndex_numElements));
    U4 maxElements = primitiveInt_getValue(objectRef_getFieldValue(array, fieldIndex_maxElements));
    printf("initialized array. numElements: %lu, maxElements: %lu\n", numElements, maxElements);
    printf("  values: [");
    HeapPointer valuesArray = objectRef_getFieldValue(array, fieldIndex_array);
    if (valuesArray != NULL) {
        assertObjectType(OBJ_PrimitiveArray, valuesArray);
        for (int i = 0; i < numElements; ++i) {
            I1 value = (I1) valuesArray->data[i];
            if (i > 0) {
                printf(", ");
            }
            printf("%hhd", value);
        }
    }
    printf("]\n");
}

int main() {
    jvm = prepareJVM(files, numFiles);

    HeapPointer array = initArray(12);
    printDynamicArray(array);

    insert(array, 14);
    printDynamicArray(array);

    for (int i = 0; i < 18; ++i) {
        insert(array, i);
    }
    printDynamicArray(array);

    destroyArray(array);

    releaseJVM(&jvm);
}